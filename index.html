<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ íŠ¸ëŸ­íŒŒí‹° ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&family=Noto+Sans+KR:wght@300;400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-color: #0a0a12;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --neon-pink: #ff00ff;
            --neon-mint: #00ffcc;
            --neon-gold: #ffd700;
            --neon-blue: #00ccff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Outfit', 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 60px 0 40px;
            background: radial-gradient(circle at center, rgba(255, 0, 255, 0.1) 0%, transparent 70%);
        }

        h1 {
            font-size: 3.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 4px;
            background: linear-gradient(to right, var(--neon-mint), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .subtitle {
            color: var(--neon-gold);
            font-size: 1.2rem;
            margin-top: 10px;
            letter-spacing: 2px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-left: 4px solid var(--neon-mint);
            padding-left: 15px;
            color: var(--text-main);
            display: flex;
            align-items: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.2);
            border-color: var(--neon-mint);
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .rank-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rank-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .rank-item:last-child {
            border-bottom: none;
        }

        .rank-num {
            font-size: 1.5rem;
            font-weight: bold;
            width: 40px;
            color: var(--neon-gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .rank-info {
            flex-grow: 1;
        }

        .rank-name {
            font-weight: bold;
            font-size: 1.1rem;
            display: block;
        }

        .rank-type {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rank-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--neon-pink);
        }

        /* Specific Layouts */
        .full-width {
            grid-column: 1 / -1;
        }

        footer {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 40px;
        }

        .custom-legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .color-box {
            width: 12px;
            height: 12px;
            margin-right: 8px;
            border-radius: 2px;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>Sooltluck Party, 3rd</h1>
            <div class="subtitle">2025.11.22, Sat</div>
        </header>

        <!-- Section 1: Overall Ranking -->
        <div class="grid">
            <div class="card full-width">
                <h2 class="section-title">ğŸ† ì „ì²´ ì£¼ë¥˜ ìˆœìœ„</h2>
                <div class="custom-legend">
                    <div class="legend-item"><span class="color-box" style="background: #00ffcc;"></span>ì „í†µì£¼</div>
                    <div class="legend-item"><span class="color-box" style="background: #ffd700;"></span>ìœ„ìŠ¤í‚¤</div>
                    <div class="legend-item"><span class="color-box" style="background: #ff00ff;"></span>ì™€ì¸</div>
                    <div class="legend-item"><span class="color-box" style="background: #00ccff;"></span>ê¸°íƒ€</div>
                </div>
                <div class="chart-container">
                    <canvas id="rankingChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Section 2: Averages Comparison -->
        <div class="grid">
            <div class="card">
                <h2 class="section-title">ğŸ“Š ì£¼ì¢…ë³„ í‰ê·  ì ìˆ˜</h2>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

        </div>

        <!-- Section 3: Top 5 by Age -->
        <h2 class="section-title">ğŸ‚ ì—°ë ¹ëŒ€ë³„ Top 5</h2>
        <div class="grid">
            <div class="card">
                <h3 style="color: var(--neon-blue); margin-top:0;">20ëŒ€ì˜ ì„ íƒ</h3>
                <ul class="rank-list" id="top20s"></ul>
            </div>
            <div class="card">
                <h3 style="color: var(--neon-pink); margin-top:0;">30ëŒ€ì˜ ì„ íƒ</h3>
                <ul class="rank-list" id="top30s"></ul>
            </div>
            <div class="card">
                <h3 style="color: var(--neon-gold); margin-top:0;">40ëŒ€ì˜ ì„ íƒ</h3>
                <ul class="rank-list" id="top40s"></ul>
            </div>
        </div>

        <!-- Section 4: Top 5 by Gender -->
        <h2 class="section-title">ğŸ‘« ì„±ë³„ Top 5</h2>
        <div class="grid">
            <div class="card">
                <h3 style="color: var(--neon-blue); margin-top:0;">Gentlemen's Pick</h3>
                <ul class="rank-list" id="topMale"></ul>
            </div>
            <div class="card">
                <h3 style="color: var(--neon-pink); margin-top:0;">Ladies' Pick</h3>
                <ul class="rank-list" id="topFemale"></ul>
            </div>
        </div>

        <footer>
            Made by Jongkook | Sooltluck Party, 3rd
        </footer>
    </div>

    <script>
        // Raw CSV Data
        const csvData = `
,,,,,,,,,,,,,,,,,,,,
,,,,ë‚˜ì´ëŒ€,30ëŒ€,20ëŒ€,30ëŒ€,20ëŒ€,20ëŒ€,20ëŒ€,20ëŒ€,40ëŒ€,40ëŒ€,20ëŒ€,30ëŒ€,30ëŒ€,40ëŒ€,20ëŒ€,30ëŒ€,20ëŒ€,30ëŒ€,
,,,,ì„±ë³„,ë‚¨,ë‚¨,ë‚¨,ì—¬,ì—¬,ë‚¨,ì—¬,ë‚¨,ë‚¨,ì—¬,ë‚¨,ì—¬,ë‚¨,ì—¬,ë‚¨,ë‚¨,ë‚¨,
,ì „í†µì£¼,ì£¼ì¢…,ì£¼ë¥˜ ì´ë¦„,No,ê¹€í—Œì§„,ì´í˜„ìš°,ì–‘ìƒìš°,ê¹€ë‚˜ì •,ìµœìˆ˜ë¹ˆ,ìµœìœ¤í•œ,ì´ì •ë¯¼,ë°•ì„±ê·œ,ì´ì¥êµ°,ìµœì§€ì›,ê¹€ë²”ì¤€,ì™•ì†Œì •,ë°•ì •í˜„,ì´ì§€ì›,ê°•íƒœìš°,ê¹€ì§„ìš±,ì´ì€ìƒ,í‰ê· 
,,ì™€ì¸,í“¨ì—”í…Œë¹„ë‚˜ FUENTEVINA,1,2,,2,2,2,2,3,2,3,2.8,3,3,4,3,4,3,3,2.74
,,ì™€ì¸,ROSA REGALE BRACHETTO D'ACQUI 2023,2,3,,3,5,4,3.5,3,3,3,2.8,3,1,2,4,4,3,2,3.08
,,ì™€ì¸,"í˜ì–´íˆì¦ˆ ì•µì»¤ ë¦¬ì œë¥´ë°”, 2022",3,3,,2,4,4,3.5,4,3,3.5,3,2,3,5,5,2.5,4,3,3.41
,,ì™€ì¸,"ì ¬ë§ˆ ë”” ë£¨ë‚˜ ëª¨ìŠ¤ì¹´í† , ëª¨ìŠ¤ì¹´í† ",4,1,4,3,5,5,4.5,5,3.5,3,3.2,4,1,2,3,5,3,2,3.36
,,í™©ì£¼,"çŸ³åº“é—¨ 9ë…„, Shanghai Shikumen (ä¸Šæµ·è€é…’)",5,1,2.5,2,0,1,2,1,3,2,1.5,2,2.5,4,3,2,2,2,1.97
,,ë§¥ì£¼,Fedora KÃ¶lsch,6,3,3,2,3,5,3.8,4,4.5,3.5,3.8,5,3,5,4,4,3,3.5,3.71
,,ì™€ì¸,MOSCATO D'ASTI 2024,7,2,4.5,2,5,5,4.2,2,1,3,3.2,4,4,1,4,5,3,2,3.23
,O,ì•½ì£¼,ì²˜ìŒìˆ  í•œì‚° ì†Œê³¡ì£¼,8,2,3.5,2,0,0,1,1,2,2.5,2,2,2.5,1,3,3,2,3,1.91
,,ì™€ì¸,Louis Perdrier Brut Excellence,9,3,3.5,3,3,2,4,4,3,,3.3,3,1,3,4,3.5,3,2,3.02
,O,ë§‰ê±¸ë¦¬,í˜¸ë‘ì´ ìœ ì ë§‰ê±¸ë¦¬,10,3,4.7,4,5,1,4.7,2,3.5,4,3.5,4,1,2,3,5,3,,3.34
,,ì™€ì¸,SWEET ROSE VINO FRIZZANTE,11,2,4,3,5,4,4.5,4,3,3.5,3.5,3,1,3,3,4,3,2.5,3.29
,,í™©ì£¼,ê¸ˆìƒ‰ë…„í™” 5ë…„,12,1,2.5,2,0,5,1,1,1.5,2,2,2,1,2,2,2,2,,1.81
,,ì‚¬ì¼€,ì•„ë¼ê³ ì‹œ ìœ ì¦ˆ ã‚ã‚‰ã”ã— ã‚†ãš,13,3,4.2,4,5,0,4.8,5,4.5,2.5,3.2,3,2,4,5,4,4,3.5,3.63
,O,ë§‰ê±¸ë¦¬,"ì„œìš¸íš¨ëª¨ë°© ì˜¨ì„¶ (ì œ 5ì•ˆ, 25/26 W/S)",14,2,4.5,3,4,0,2,3,,2,2,2,3,4,4,3,3,3.5,2.81
,O,ì•½ì£¼,"ê°íƒ„ì£¼ (ê¸°íƒ€ì£¼ë¥˜, ê³¼í•˜ì£¼ ìŠ¤íƒ€ì¼)",15,1,2.7,2,4,5,4,3,4,3,2.8,4,3.5,4,2,5,3,3.5,3.32
,O,ë¯¸ë“œ,í—ˆë‹ˆë¹„ ì™€ì¸,16,2,4.4,4,5,,4,4,4,4,3.8,4,3,5,4,3,3,3,3.76
,,ì™€ì¸,BRICCO QUAGLIA MOSCATO D'ASTI 2022,17,3,4,4.5,5,,4.2,5,5,4.5,3.5,4,3,4,4,3,3,2,3.86
,,ì™€ì¸,Louis Perdrier Brut Excellence (9ë²ˆê³¼ ë™ì¼),18,2,3.8,3,3,,3,3,4.5,3,3.8,2,1,5,4,4,4,,3.27
,,ì™€ì¸,PORTO VALDOURO TAWNY PORT,19,1,3.2,3,1,,3,3,3,3.5,3.7,3,3,2,4,4,3,3,2.90
,O,ë¯¸ë“œ,ì½”ì•„ë² ìŠ¤íŠ¸ ì‚¬ì›Œë³´ì‰,20,2,3.7,3,3,,4.4,3,3.5,4,4,3,4,4,5,4,3,4,3.60
,,ë¦¬íë¥´,ë³µë¶„ìì£¼ (ë¹„ë§¤í’ˆ),21,1,3.5,2,4,,2.5,5,4,,3.5,4,3,4,4,5,3,4.5,3.53
,O,ì¦ë¥˜ì£¼,ì‚­ SAK ë¸”ë™ 50,22,1,3.7,2,,,3,2,4,2.5,3.5,3,2,3,3,5,4,4.5,3.08
,,ì‚¬ì¼€,ìŠ¤ì´ê²Œì´ í† ì¿ ë² ì¸  ì¤€ë§ˆì´ (Drunken Whale),23,2,3.9,2,,,3.2,3,,3.5,,3,1.5,5,3,4.5,3,4.5,3.24
,,ìœ„ìŠ¤í‚¤,THE GLENLEE ë¸”ë Œë””ë“œ ìŠ¤ì¹´ì¹˜ ìœ„ìŠ¤í‚¤ BATCH NO:2,24,3,4.2,4,,,1.8,2,4,4,3.2,3,2,4,4,4,4,4.5,3.45
,,ìœ„ìŠ¤í‚¤,Laproaig Quater cask,25,3,4.7,5,,,4.5,3,4,3.5,,3,3,3,3,3.5,4,3,3.59
,,ìœ„ìŠ¤í‚¤,Ardbeg Corryvreckan,26,3,4.5,4.5,,,5,5,3,5,4.3,4,4,3,3.5,3.5,4,3,3.95
,O,ì†Œì£¼,"ë°±ì œì†Œì£¼, ìˆ  ìµëŠ” ì§‘ ì—ë””ì…˜",27,1,2.4,3,,,2.9,4,2,2.5,,3,0,4,4,5,4,3.5,2.95
,,ì¼ë³¸ ì†Œì£¼,DAIYAME Hamada Syuzou (ê³ êµ¬ë§ˆ ì†Œì£¼),28,2,2.8,3,1,,3,4,3.5,3,,3,3,3,4,3,3,3.5,2.99
,,ìœ„ìŠ¤í‚¤,"í•„ë¦¬í•€ ìœ„ìŠ¤í‚¤, ì˜¤í¬ ìºìŠ¤í¬",29,2,4.7,3,2,,3.4,4,,,3.6,3,4,4,4.5,4,4,2,3.44
,,,,,2.07,3.73,2.93,3.22,2.87,3.36,3.28,3.31,3.21,3.18,3.14,2.38,3.41,3.66,3.84,3.21,3.10,3.18
`;

        // --- Data Parsing Logic ---
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');

            // Line 2: Age Groups (Index 5 to 21)
            const ageLine = lines[1].split(',');
            const ages = ageLine.slice(5, 22); // 17 evaluators

            // Line 3: Gender (Index 5 to 21)
            const genderLine = lines[2].split(',');
            const genders = genderLine.slice(5, 22);

            // Line 5 onwards: Liquor Data
            const liquors = [];

            for (let i = 4; i < lines.length; i++) {
                const line = lines[i];
                if (!line.trim() || line.startsWith(',,,,,')) continue; // Skip empty or summary lines

                // Handle quoted strings (e.g., "Name, with comma")
                // Simple regex split won't work perfectly for nested commas, but let's try a robust split
                // Or since we know the structure, we can be smarter.
                // Actually, let's use a simple regex for CSV splitting that handles quotes
                const row = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
                // The above regex is a bit flaky. Let's write a proper simple parser or just handle the specific known quotes.
                // Given the data, names are in quotes if they contain commas.

                // Better approach: Split by comma, but rejoin if inside quotes.
                const parts = [];
                let current = '';
                let inQuote = false;

                for (let char of line) {
                    if (char === '"') {
                        inQuote = !inQuote;
                    } else if (char === ',' && !inQuote) {
                        parts.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                parts.push(current);

                // Clean up parts (remove surrounding quotes)
                const cleanParts = parts.map(p => p.trim().replace(/^"|"$/g, ''));

                const isTraditional = cleanParts[1] === 'O';
                const type = cleanParts[2];
                const name = cleanParts[3];
                const scores = cleanParts.slice(5, 22).map(s => s === '' ? null : parseFloat(s));

                // Calculate average (ignoring nulls)
                const validScores = scores.filter(s => s !== null);
                const average = validScores.reduce((a, b) => a + b, 0) / validScores.length;

                liquors.push({
                    isTraditional,
                    type,
                    name,
                    scores,
                    average
                });
            }

            return { ages, genders, liquors };
        }

        const data = parseCSV(csvData);

        // --- Data Processing ---

        // 1. Overall Ranking
        const sortedByAvg = [...data.liquors].sort((a, b) => b.average - a.average);

        // 2. Category Averages
        function getCategoryAvg(filterFn) {
            const filtered = data.liquors.filter(filterFn);
            if (filtered.length === 0) return 0;
            const sum = filtered.reduce((acc, curr) => acc + curr.average, 0);
            return sum / filtered.length;
        }

        const avgTraditional = getCategoryAvg(l => l.isTraditional);
        const avgWhisky = getCategoryAvg(l => l.type.includes('ìœ„ìŠ¤í‚¤'));
        const avgWine = getCategoryAvg(l => l.type.includes('ì™€ì¸'));
        const avgOverall = getCategoryAvg(() => true);

        // 3. Top 5 by Age/Gender
        function getTop5By(filterIndexFn) {
            // Calculate average for each liquor based ONLY on specific evaluators
            const ranked = data.liquors.map(l => {
                const relevantScores = l.scores.filter((_, idx) => filterIndexFn(idx));
                const validScores = relevantScores.filter(s => s !== null);
                const avg = validScores.length ? validScores.reduce((a, b) => a + b, 0) / validScores.length : -1;
                return { ...l, specificAvg: avg };
            }).sort((a, b) => b.specificAvg - a.specificAvg);

            return ranked.slice(0, 5);
        }

        const top20s = getTop5By(idx => data.ages[idx] === '20ëŒ€');
        const top30s = getTop5By(idx => data.ages[idx] === '30ëŒ€');
        const top40s = getTop5By(idx => data.ages[idx] === '40ëŒ€');

        const topMale = getTop5By(idx => data.genders[idx] === 'ë‚¨');
        const topFemale = getTop5By(idx => data.genders[idx] === 'ì—¬');

        // --- Rendering ---

        // Chart Global Defaults
        Chart.defaults.color = '#a0a0a0';
        Chart.defaults.font.family = "'Outfit', sans-serif";

        // 1. Ranking Chart
        new Chart(document.getElementById('rankingChart'), {
            type: 'bar',
            data: {
                labels: sortedByAvg.map(l => l.name.length > 15 ? l.name.substring(0, 15) + '...' : l.name),
                datasets: [{
                    label: 'í‰ê·  ì ìˆ˜',
                    data: sortedByAvg.map(l => l.average),
                    backgroundColor: sortedByAvg.map(l => {
                        if (l.type.includes('ìœ„ìŠ¤í‚¤')) return 'rgba(255, 215, 0, 0.7)'; // Gold
                        if (l.type.includes('ì™€ì¸')) return 'rgba(255, 0, 255, 0.7)'; // Pink
                        if (l.isTraditional) return 'rgba(0, 255, 204, 0.7)'; // Mint
                        return 'rgba(0, 204, 255, 0.7)'; // Blue
                    }),
                    borderColor: sortedByAvg.map(l => {
                        if (l.type.includes('ìœ„ìŠ¤í‚¤')) return '#ffd700';
                        if (l.type.includes('ì™€ì¸')) return '#ff00ff';
                        if (l.isTraditional) return '#00ffcc';
                        return '#00ccff';
                    }),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.raw.toFixed(2)} / 5.0`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 5,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        const countTraditional = data.liquors.filter(l => l.isTraditional).length;
        const countWhisky = data.liquors.filter(l => l.type.includes('ìœ„ìŠ¤í‚¤')).length;
        const countWine = data.liquors.filter(l => l.type.includes('ì™€ì¸')).length;

        // 2. Category Chart
        new Chart(document.getElementById('categoryChart'), {
            data: {
                labels: [`ì „í†µì£¼ (${countTraditional})`, `ìœ„ìŠ¤í‚¤ (${countWhisky})`, `ì™€ì¸ (${countWine})`],
                datasets: [
                    {
                        type: 'bar',
                        label: 'í‰ê·  ì ìˆ˜',
                        data: [avgTraditional, avgWhisky, avgWine],
                        backgroundColor: [
                            'rgba(0, 255, 204, 0.7)', // Traditional (Mint)
                            'rgba(255, 215, 0, 0.7)', // Whisky (Gold)
                            'rgba(255, 0, 255, 0.7)', // Wine (Pink)
                        ],
                        borderColor: [
                            '#00ffcc',
                            '#ffd700',
                            '#ff00ff',
                        ],
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        type: 'line',
                        label: `ì „ì²´ í‰ê·  (29ê°œ, ${avgOverall.toFixed(2)})`,
                        data: [avgOverall, avgOverall, avgOverall],
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false,
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        labels: { color: '#a0a0a0' }
                    },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toFixed(2)} / 5.0`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 5,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });



        // Render Lists
        function renderList(elementId, items) {
            const el = document.getElementById(elementId);
            items.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'rank-item';
                li.innerHTML = `
                <div class="rank-num">${index + 1}</div>
                <div class="rank-info">
                    <span class="rank-name">${item.name}</span>
                    <span class="rank-type">${item.type}</span>
                </div>
                <div class="rank-score">${item.specificAvg.toFixed(2)}</div>
            `;
                el.appendChild(li);
            });
        }

        renderList('top20s', top20s);
        renderList('top30s', top30s);
        renderList('top40s', top40s);
        renderList('topMale', topMale);
        renderList('topFemale', topFemale);

    </script>
</body>

</html>